<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>src/PartialParser.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <input type="text" id="nav-search" placeholder="Search" />
    
    <h2><a href="index.html">Home</a></h2><h2><a href="https://github.com/opatomic/opac-js" target="_blank" class="menu-item" id="repository" >Github repo</a></h2><h3>Classes</h3><ul><li><a href="BigDec.html">BigDec</a><ul class='members'><li data-type='member' style='display: none;'><a href="BigDec.html#.ONE">ONE</a></li><li data-type='member' style='display: none;'><a href="BigDec.html#.ROUND_CEILING">ROUND_CEILING</a></li><li data-type='member' style='display: none;'><a href="BigDec.html#.ROUND_DOWN">ROUND_DOWN</a></li><li data-type='member' style='display: none;'><a href="BigDec.html#.ROUND_FLOOR">ROUND_FLOOR</a></li><li data-type='member' style='display: none;'><a href="BigDec.html#.ROUND_HALF_DOWN">ROUND_HALF_DOWN</a></li><li data-type='member' style='display: none;'><a href="BigDec.html#.ROUND_HALF_EVEN">ROUND_HALF_EVEN</a></li><li data-type='member' style='display: none;'><a href="BigDec.html#.ROUND_HALF_UP">ROUND_HALF_UP</a></li><li data-type='member' style='display: none;'><a href="BigDec.html#.ROUND_UNNECESSARY">ROUND_UNNECESSARY</a></li><li data-type='member' style='display: none;'><a href="BigDec.html#.ROUND_UP">ROUND_UP</a></li><li data-type='member' style='display: none;'><a href="BigDec.html#.TEN">TEN</a></li><li data-type='member' style='display: none;'><a href="BigDec.html#.ZERO">ZERO</a></li></ul><ul class='methods'><li data-type='method' style='display: none;'><a href="BigDec.html#abs">abs</a></li><li data-type='method' style='display: none;'><a href="BigDec.html#add">add</a></li><li data-type='method' style='display: none;'><a href="BigDec.html#byteValue">byteValue</a></li><li data-type='method' style='display: none;'><a href="BigDec.html#byteValueExact">byteValueExact</a></li><li data-type='method' style='display: none;'><a href="BigDec.html#clone">clone</a></li><li data-type='method' style='display: none;'><a href="BigDec.html#compareTo">compareTo</a></li><li data-type='method' style='display: none;'><a href="BigDec.html#divide">divide</a></li><li data-type='method' style='display: none;'><a href="BigDec.html#divideAndRemainder">divideAndRemainder</a></li><li data-type='method' style='display: none;'><a href="BigDec.html#divideToIntegralValue">divideToIntegralValue</a></li><li data-type='method' style='display: none;'><a href="BigDec.html#equals">equals</a></li><li data-type='method' style='display: none;'><a href="BigDec.html#intValue">intValue</a></li><li data-type='method' style='display: none;'><a href="BigDec.html#intValueExact">intValueExact</a></li><li data-type='method' style='display: none;'><a href="BigDec.html#max">max</a></li><li data-type='method' style='display: none;'><a href="BigDec.html#min">min</a></li><li data-type='method' style='display: none;'><a href="BigDec.html#movePointLeft">movePointLeft</a></li><li data-type='method' style='display: none;'><a href="BigDec.html#movePointRight">movePointRight</a></li><li data-type='method' style='display: none;'><a href="BigDec.html#multiply">multiply</a></li><li data-type='method' style='display: none;'><a href="BigDec.html#negate">negate</a></li><li data-type='method' style='display: none;'><a href="BigDec.html#pow">pow</a></li><li data-type='method' style='display: none;'><a href="BigDec.html#precision">precision</a></li><li data-type='method' style='display: none;'><a href="BigDec.html#remainder">remainder</a></li><li data-type='method' style='display: none;'><a href="BigDec.html#scale">scale</a></li><li data-type='method' style='display: none;'><a href="BigDec.html#scaleByPowerOfTen">scaleByPowerOfTen</a></li><li data-type='method' style='display: none;'><a href="BigDec.html#setScale">setScale</a></li><li data-type='method' style='display: none;'><a href="BigDec.html#shortValue">shortValue</a></li><li data-type='method' style='display: none;'><a href="BigDec.html#shortValueExact">shortValueExact</a></li><li data-type='method' style='display: none;'><a href="BigDec.html#signum">signum</a></li><li data-type='method' style='display: none;'><a href="BigDec.html#stripTrailingZeros">stripTrailingZeros</a></li><li data-type='method' style='display: none;'><a href="BigDec.html#subtract">subtract</a></li><li data-type='method' style='display: none;'><a href="BigDec.html#toBigInteger">toBigInteger</a></li><li data-type='method' style='display: none;'><a href="BigDec.html#toBigIntegerExact">toBigIntegerExact</a></li><li data-type='method' style='display: none;'><a href="BigDec.html#toEngineeringString">toEngineeringString</a></li><li data-type='method' style='display: none;'><a href="BigDec.html#toPlainString">toPlainString</a></li><li data-type='method' style='display: none;'><a href="BigDec.html#toString">toString</a></li><li data-type='method' style='display: none;'><a href="BigDec.html#ulp">ulp</a></li><li data-type='method' style='display: none;'><a href="BigDec.html#unscaledValue">unscaledValue</a></li></ul></li><li><a href="BigInteger.html">BigInteger</a><ul class='members'><li data-type='member' style='display: none;'><a href="BigInteger.html#.ONE">ONE</a></li><li data-type='member' style='display: none;'><a href="BigInteger.html#.ZERO">ZERO</a></li></ul><ul class='methods'><li data-type='method' style='display: none;'><a href="BigInteger.html#abs">abs</a></li><li data-type='method' style='display: none;'><a href="BigInteger.html#add">add</a></li><li data-type='method' style='display: none;'><a href="BigInteger.html#and">and</a></li><li data-type='method' style='display: none;'><a href="BigInteger.html#andNot">andNot</a></li><li data-type='method' style='display: none;'><a href="BigInteger.html#bitCount">bitCount</a></li><li data-type='method' style='display: none;'><a href="BigInteger.html#bitLength">bitLength</a></li><li data-type='method' style='display: none;'><a href="BigInteger.html#byteValue">byteValue</a></li><li data-type='method' style='display: none;'><a href="BigInteger.html#clearBit">clearBit</a></li><li data-type='method' style='display: none;'><a href="BigInteger.html#compareTo">compareTo</a></li><li data-type='method' style='display: none;'><a href="BigInteger.html#divide">divide</a></li><li data-type='method' style='display: none;'><a href="BigInteger.html#divideAndRemainder">divideAndRemainder</a></li><li data-type='method' style='display: none;'><a href="BigInteger.html#flipBit">flipBit</a></li><li data-type='method' style='display: none;'><a href="BigInteger.html#gcd">gcd</a></li><li data-type='method' style='display: none;'><a href="BigInteger.html#getLowestSetBit">getLowestSetBit</a></li><li data-type='method' style='display: none;'><a href="BigInteger.html#intValue">intValue</a></li><li data-type='method' style='display: none;'><a href="BigInteger.html#max">max</a></li><li data-type='method' style='display: none;'><a href="BigInteger.html#min">min</a></li><li data-type='method' style='display: none;'><a href="BigInteger.html#mod">mod</a></li><li data-type='method' style='display: none;'><a href="BigInteger.html#modInverse">modInverse</a></li><li data-type='method' style='display: none;'><a href="BigInteger.html#modPow">modPow</a></li><li data-type='method' style='display: none;'><a href="BigInteger.html#multiply">multiply</a></li><li data-type='method' style='display: none;'><a href="BigInteger.html#negate">negate</a></li><li data-type='method' style='display: none;'><a href="BigInteger.html#not">not</a></li><li data-type='method' style='display: none;'><a href="BigInteger.html#or">or</a></li><li data-type='method' style='display: none;'><a href="BigInteger.html#pow">pow</a></li><li data-type='method' style='display: none;'><a href="BigInteger.html#remainder">remainder</a></li><li data-type='method' style='display: none;'><a href="BigInteger.html#setBit">setBit</a></li><li data-type='method' style='display: none;'><a href="BigInteger.html#shiftLeft">shiftLeft</a></li><li data-type='method' style='display: none;'><a href="BigInteger.html#shiftRight">shiftRight</a></li><li data-type='method' style='display: none;'><a href="BigInteger.html#shortValue">shortValue</a></li><li data-type='method' style='display: none;'><a href="BigInteger.html#signum">signum</a></li><li data-type='method' style='display: none;'><a href="BigInteger.html#subtract">subtract</a></li><li data-type='method' style='display: none;'><a href="BigInteger.html#testBit">testBit</a></li><li data-type='method' style='display: none;'><a href="BigInteger.html#toByteArray">toByteArray</a></li><li data-type='method' style='display: none;'><a href="BigInteger.html#toString">toString</a></li><li data-type='method' style='display: none;'><a href="BigInteger.html#xor">xor</a></li></ul></li><li><a href="ClientConfig.html">ClientConfig</a><ul class='methods'><li data-type='method' style='display: none;'><a href="ClientConfig.html#clientErrorHandler">clientErrorHandler</a></li><li data-type='method' style='display: none;'><a href="ClientConfig.html#uncaughtExceptionHandler">uncaughtExceptionHandler</a></li><li data-type='method' style='display: none;'><a href="ClientConfig.html#unknownIdHandler">unknownIdHandler</a></li></ul></li><li><a href="EventClient.html">EventClient</a><ul class='methods'><li data-type='method' style='display: none;'><a href="EventClient.html#call">call</a></li><li data-type='method' style='display: none;'><a href="EventClient.html#callA">callA</a></li><li data-type='method' style='display: none;'><a href="EventClient.html#callID">callID</a></li><li data-type='method' style='display: none;'><a href="EventClient.html#flush">flush</a></li><li data-type='method' style='display: none;'><a href="EventClient.html#onClose">onClose</a></li><li data-type='method' style='display: none;'><a href="EventClient.html#onRecv">onRecv</a></li><li data-type='method' style='display: none;'><a href="EventClient.html#registerCB">registerCB</a></li></ul></li><li><a href="OpaDef.html">OpaDef</a><ul class='members'><li data-type='member' style='display: none;'><a href="OpaDef.html#.ARRAYEND">ARRAYEND</a></li><li data-type='member' style='display: none;'><a href="OpaDef.html#.ARRAYSTART">ARRAYSTART</a></li><li data-type='member' style='display: none;'><a href="OpaDef.html#.BINLPVI">BINLPVI</a></li><li data-type='member' style='display: none;'><a href="OpaDef.html#.EMPTYARRAY">EMPTYARRAY</a></li><li data-type='member' style='display: none;'><a href="OpaDef.html#.EMPTYBIN">EMPTYBIN</a></li><li data-type='member' style='display: none;'><a href="OpaDef.html#.EMPTYSTR">EMPTYSTR</a></li><li data-type='member' style='display: none;'><a href="OpaDef.html#.ERR_CLOSED">ERR_CLOSED</a></li><li data-type='member' style='display: none;'><a href="OpaDef.html#.FALSE">FALSE</a></li><li data-type='member' style='display: none;'><a href="OpaDef.html#.NEGBIGINT">NEGBIGINT</a></li><li data-type='member' style='display: none;'><a href="OpaDef.html#.NEGINF">NEGINF</a></li><li data-type='member' style='display: none;'><a href="OpaDef.html#.NEGNEGBIGDEC">NEGNEGBIGDEC</a></li><li data-type='member' style='display: none;'><a href="OpaDef.html#.NEGNEGVARDEC">NEGNEGVARDEC</a></li><li data-type='member' style='display: none;'><a href="OpaDef.html#.NEGPOSBIGDEC">NEGPOSBIGDEC</a></li><li data-type='member' style='display: none;'><a href="OpaDef.html#.NEGPOSVARDEC">NEGPOSVARDEC</a></li><li data-type='member' style='display: none;'><a href="OpaDef.html#.NEGVARINT">NEGVARINT</a></li><li data-type='member' style='display: none;'><a href="OpaDef.html#.NULL">NULL</a></li><li data-type='member' style='display: none;'><a href="OpaDef.html#.POSBIGINT">POSBIGINT</a></li><li data-type='member' style='display: none;'><a href="OpaDef.html#.POSINF">POSINF</a></li><li data-type='member' style='display: none;'><a href="OpaDef.html#.POSNEGBIGDEC">POSNEGBIGDEC</a></li><li data-type='member' style='display: none;'><a href="OpaDef.html#.POSNEGVARDEC">POSNEGVARDEC</a></li><li data-type='member' style='display: none;'><a href="OpaDef.html#.POSPOSBIGDEC">POSPOSBIGDEC</a></li><li data-type='member' style='display: none;'><a href="OpaDef.html#.POSPOSVARDEC">POSPOSVARDEC</a></li><li data-type='member' style='display: none;'><a href="OpaDef.html#.POSVARINT">POSVARINT</a></li><li data-type='member' style='display: none;'><a href="OpaDef.html#.SORTMAX">SORTMAX</a></li><li data-type='member' style='display: none;'><a href="OpaDef.html#.SORTMAX_OBJ">SORTMAX_OBJ</a></li><li data-type='member' style='display: none;'><a href="OpaDef.html#.STRLPVI">STRLPVI</a></li><li data-type='member' style='display: none;'><a href="OpaDef.html#.TRUE">TRUE</a></li><li data-type='member' style='display: none;'><a href="OpaDef.html#.UNDEFINED">UNDEFINED</a></li><li data-type='member' style='display: none;'><a href="OpaDef.html#.ZERO">ZERO</a></li></ul></li><li><a href="PartialParser.html">PartialParser</a><ul class='methods'><li data-type='method' style='display: none;'><a href="PartialParser.html#parseNext">parseNext</a></li></ul></li><li><a href="PartialParser.Buff.html">PartialParser.Buff</a></li><li><a href="Queue.html">Queue</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Queue.html#push">push</a></li><li data-type='method' style='display: none;'><a href="Queue.html#shift">shift</a></li><li data-type='method' style='display: none;'><a href="Queue.html#size">size</a></li></ul></li><li><a href="Serializer.html">Serializer</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Serializer.html#flush">flush</a></li><li data-type='method' style='display: none;'><a href="Serializer.html#write">write</a></li><li data-type='method' style='display: none;'><a href="Serializer.html#write1">write1</a></li><li data-type='method' style='display: none;'><a href="Serializer.html#writeArray">writeArray</a></li><li data-type='method' style='display: none;'><a href="Serializer.html#writeNumber">writeNumber</a></li><li data-type='method' style='display: none;'><a href="Serializer.html#writeObject">writeObject</a></li><li data-type='method' style='display: none;'><a href="Serializer.html#writeString">writeString</a></li></ul></li></ul><h3>Interfaces</h3><ul><li><a href="IWriter.html">IWriter</a><ul class='methods'><li data-type='method' style='display: none;'><a href="IWriter.html#close">close</a></li><li data-type='method' style='display: none;'><a href="IWriter.html#flush">flush</a></li><li data-type='method' style='display: none;'><a href="IWriter.html#write">write</a></li></ul></li></ul><h3>Global</h3><ul><li><a href="global.html#opaType">opaType</a></li><li><a href="global.html#ResponseCallback">ResponseCallback</a></li><li><a href="global.html#RoundingMode">RoundingMode</a></li><li><a href="global.html#stringify">stringify</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">src/PartialParser.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/*
 * Copyright 2018-2019 Opatomic
 * Open sourced with ISC license. Refer to LICENSE for details.
 */

// Dependencies: BigInteger, BigDec, OpaDef, NEWBUF, STRDEC

/**
 * @constructor
 */
var PartialParser = function() {};

(function() {

var S_NEXTOBJ = 1;
var S_VARINT1 = 2;
var S_VARINT2 = 3;
var S_VARDEC1 = 4;
var S_VARDEC2 = 5;
var S_BIGINT  = 6;
var S_BIGDEC1 = 7;
var S_BIGDEC2 = 8;
var S_BYTES1  = 9;
var S_BYTES2  = 10;
var S_BLOB    = 11;
var S_STR     = 12;
var S_ERR     = 13;

/** @const {!OpaBuff} */
var TMPBUF = NEWBUF(8);

/** @const {!OpaBuff} */
var EMPTYBUF = NEWBUF(0);

/**
 * @constructor
 */
PartialParser = function() {
	/** @type {!Array&lt;*>} */
	this.mContainers = [];
	/** @type {?Array} */
	this.mCurrCont = null;
	/** @type {number} */
	this.mState = S_NEXTOBJ;
	/** @type {number} */
	this.mNextState = 0;
	/** @type {number} */
	this.mNextState2 = 0;
	/** @type {number} */
	this.mVarintVal1 = 0;
	/** @type {number} */
	this.mVarintVal2 = 0;
	/** @type {number} */
	this.mVarintLen = 0;
	/** @type {number} */
	this.mDecExp = 0;
	/** @type {number} */
	this.mObjType = 0;
	/** @type {number} */
	this.mBytesIdx = 0;
	/** @type {number} */
	this.mBytesLen = 0;
	/** @type {!OpaBuff} */
	this.mBytes = EMPTYBUF;
};

/**
 * @param {!PartialParser} p
 * @param {string} msg
 */
function throwErr(p, msg) {
	p.mState = S_ERR;
	throw new Error(msg);
}

/**
 * @param {!PartialParser} p
 * @param {*} o
 */
function hitNext(p, o) {
	if (p.mCurrCont == null) {
		throwErr(p, "no array container");
	}
	p.mCurrCont.push(o);
}

/**
 * @param {!PartialParser} p
 * @param {*} o
 */
function hitNextAndReset(p, o) {
	hitNext(p, o);
	if (p.mBytes.length > 4096) {
		p.mBytes = EMPTYBUF;
	}
	p.mState = S_NEXTOBJ;
}

/**
 * @param {!PartialParser} p
 * @param {number} objType
 * @param {number} nextState
 */
function initVarint(p, objType, nextState) {
	p.mState = S_VARINT1;
	p.mNextState = nextState;
	p.mObjType = objType;
	p.mVarintVal1 = 0;
	p.mVarintVal2 = 0;
	p.mVarintLen = 0;
}

/**
 * @param {!PartialParser} p
 * @param {number} objType
 * @param {number} nextState
 */
function initBytes(p, objType, nextState) {
	initVarint(p, objType, S_BYTES1);
	p.mNextState2 = nextState;
}

/**
 * @param {!PartialParser} p
 * @param {boolean} neg
 * @return {number}
 */
function getVarint32(p, neg) {
	if (neg) {
		return 0 - getVarint32(p, false);
	}
	if (p.mVarintLen &lt; 5) {
		return p.mVarintVal1;
	}
	var t = (p.mVarintVal2 * 4294967296) + p.mVarintVal1;
	if (!isSafeInteger(t) || t > 2147483647) {
		throwErr(p, "varint out of range");
	}
	return t;
}

/**
 * @param {number} num
 * @param {!Uint8Array} b
 * @param {number} idx
 */
function num32ToBuff(num, b, idx) {
	for (var i = 3; i >= 0; --i) {
		b[idx + i] = num &amp; 0xFF;
		num >>>= 8;
	}
}

/**
 * @param {!PartialParser} p
 * @param {boolean} neg
 * @return {number|!BigInteger}
 */
function getVarIntVal(p, neg) {
	if (p.mVarintLen &lt; 5) {
		return neg ? (p.mVarintVal1 == 0 ? -0 : 0 - p.mVarintVal1) : p.mVarintVal1;
	}
	var t = (p.mVarintVal2 * 4294967296) + p.mVarintVal1;
	if (isSafeInteger(t)) {
		return neg ? 0 - t : t;
	}
	num32ToBuff(p.mVarintVal2, TMPBUF, 0);
	num32ToBuff(p.mVarintVal1, TMPBUF, 4);
	return bigIntFromBytes(neg, TMPBUF, 0, 8);
}

/**
 * @param {!PartialParser} p
 * @param {number} bval
 */
function varintNextByte(p, bval) {
	if (p.mVarintLen &lt; 4) {
		p.mVarintVal1 |= (bval &amp; 0x7F) &lt;&lt; (p.mVarintLen * 7);
	} else if (p.mVarintLen == 4) {
		// 4 bits go into mVarintVal1; cannot use bit-wise operations
		p.mVarintVal1 += (bval &amp; 0x0F) * 268435456;
		// 3 bits go into mVarintVal2
		p.mVarintVal2 = (bval &amp; 0x70) >> 4;
	} else if (p.mVarintLen &lt; 9) {
		p.mVarintVal2 |= (bval &amp; 0x7F) &lt;&lt; (3 + ((p.mVarintLen - 5) * 7));
	} else {
		throwErr(p, "varint too big");
	}
	p.mVarintLen++;
}

/**
 * @param {!OpaBuff} b
 * @return {string}
 */
function getstr(b) {
	return STRDEC(b);
}

/**
 * @param {!PartialParser} p
 * @param {!PartialParser.Buff} b
 * @return {?Array}
 */
function parseNext(p, b) {
	var buff = b.data;
	var idx = b.idx;
	var stop = b.idx + b.len;
	MainLoop:
	while (true) {
		switch (p.mState) {
			case S_NEXTOBJ:
				if (idx >= stop) {
					b.idx = idx;
					b.len = 0;
					return null;
				}
				switch (buff[idx++]) {
					case CH_UNDEFINED:  hitNext(p, undefined); continue;
					case CH_NULL:       hitNext(p, null);      continue;
					case CH_FALSE:      hitNext(p, false);     continue;
					case CH_TRUE:       hitNext(p, true);      continue;
					case CH_ZERO:       hitNext(p, 0);         continue;
					case CH_NEGINF:     hitNext(p, -Infinity); continue;
					case CH_POSINF:     hitNext(p, Infinity);  continue;
					case CH_EMPTYBIN:   hitNext(p, NEWBUF(0)); continue;
					case CH_EMPTYSTR:   hitNext(p, "");        continue;
					case CH_EMPTYARRAY: hitNext(p, []);        continue;
					case CH_SORTMAX:    hitNext(p, OpaDef.SORTMAX_OBJ); continue;

					case CH_NEGVARINT: initVarint(p, CH_NEGVARINT, S_VARINT2); continue;
					case CH_POSVARINT: initVarint(p, CH_POSVARINT, S_VARINT2); continue;

					case CH_NEGBIGINT: initBytes(p, CH_NEGBIGINT, S_BIGINT); continue;
					case CH_POSBIGINT: initBytes(p, CH_POSBIGINT, S_BIGINT); continue;

					case CH_POSPOSVARDEC: initVarint(p, CH_POSPOSVARDEC, S_VARDEC1); continue;
					case CH_POSNEGVARDEC: initVarint(p, CH_POSNEGVARDEC, S_VARDEC1); continue;
					case CH_NEGPOSVARDEC: initVarint(p, CH_NEGPOSVARDEC, S_VARDEC1); continue;
					case CH_NEGNEGVARDEC: initVarint(p, CH_NEGNEGVARDEC, S_VARDEC1); continue;

					case CH_POSPOSBIGDEC: initVarint(p, CH_POSPOSBIGDEC, S_BIGDEC1); continue;
					case CH_POSNEGBIGDEC: initVarint(p, CH_POSNEGBIGDEC, S_BIGDEC1); continue;
					case CH_NEGPOSBIGDEC: initVarint(p, CH_NEGPOSBIGDEC, S_BIGDEC1); continue;
					case CH_NEGNEGBIGDEC: initVarint(p, CH_NEGNEGBIGDEC, S_BIGDEC1); continue;

					case CH_BINLPVI: initBytes(p, CH_BINLPVI, S_BLOB); continue;
					case CH_STRLPVI: initBytes(p, CH_STRLPVI, S_STR);  continue;

					case CH_ARRAYSTART:
						if (p.mCurrCont != null) {
							p.mContainers.push(p.mCurrCont);
						}
						p.mCurrCont = [];
						continue;
					case CH_ARRAYEND:
						if (p.mCurrCont == null) {
							throwErr(p, "array end token when not in array");
						}
						if (p.mContainers.length == 0) {
							var tmp = p.mCurrCont;
							p.mCurrCont = null;
							b.idx = idx;
							b.len = stop - idx;
							return tmp;
						}
						var parent = /** @type {!Array} */ (p.mContainers.pop());
						parent.push(p.mCurrCont);
						p.mCurrCont = parent;
						continue;
					default:
						throwErr(p, "unknown char");
				} // eslint-disable-line no-fallthrough

			case S_VARINT1:
				while (true) {
					if (idx >= stop) {
						b.idx = idx;
						b.len = 0;
						return null;
					}
					var bval = buff[idx++];
					varintNextByte(p, bval);
					if ((bval &amp; 0x80) == 0) {
						p.mState = p.mNextState;
						continue MainLoop;
					}
				}
			case S_VARINT2:
				hitNext(p, getVarIntVal(p, p.mObjType == CH_NEGVARINT));
				p.mState = S_NEXTOBJ;
				continue;
			case S_BYTES1:
				p.mBytesLen = getVarint32(p, false);
				if (p.mBytes.length &lt; p.mBytesLen) {
					p.mBytes = NEWBUF(p.mBytesLen);
				}
				p.mBytesIdx = 0;
				p.mState = S_BYTES2;
				// fall through
			case S_BYTES2:
				var numToCopy = Math.min(stop - idx, p.mBytesLen - p.mBytesIdx);
				p.mBytes.set(buff.subarray(idx, idx + numToCopy), p.mBytesIdx);
				p.mBytesIdx += numToCopy;
				idx += numToCopy;
				if (p.mBytesIdx &lt; p.mBytesLen) {
					b.idx = idx;
					b.len = 0;
					return null;
				}
				p.mState = p.mNextState2;
				continue;
			case S_BIGINT:
				hitNextAndReset(p, bigIntFromBytes(p.mObjType == CH_NEGBIGINT, p.mBytes, 0, p.mBytesLen));
				continue;

			case S_VARDEC1:
				p.mDecExp = getVarint32(p, p.mObjType == CH_NEGPOSVARDEC || p.mObjType == CH_NEGNEGVARDEC);
				initVarint(p, p.mObjType, S_VARDEC2);
				continue;
			case S_VARDEC2:
				var m1 = getVarIntVal(p, p.mObjType == CH_POSNEGVARDEC || p.mObjType == CH_NEGNEGVARDEC);
				m1 = (typeof m1 == "number") ? bigIntFromNumber(m1) : m1;
				hitNext(p, new BigDec(m1, 0 - p.mDecExp));
				p.mState = S_NEXTOBJ;
				continue;

			case S_BIGDEC1:
				p.mDecExp = getVarint32(p, p.mObjType == CH_NEGPOSBIGDEC || p.mObjType == CH_NEGNEGBIGDEC);
				initBytes(p, p.mObjType, S_BIGDEC2);
				continue;
			case S_BIGDEC2:
				var m2 = bigIntFromBytes(p.mObjType == CH_POSNEGBIGDEC || p.mObjType == CH_NEGNEGBIGDEC, p.mBytes, 0, p.mBytesLen);
				hitNextAndReset(p, new BigDec(m2, 0 - p.mDecExp));
				continue;

			case S_BLOB:
				// TODO: if p.mBytes.length is large then the subarray will be larger than needed
				//   create smaller array and copy data to smaller array??
				//   create simple array if len is short (not buffer/uint8array)? what is the cutoff length?
				hitNext(p, p.mBytes.subarray(0, p.mBytesLen));
				// cannot reuse buffer! since it is returned to caller
				p.mBytes = EMPTYBUF;
				p.mState = S_NEXTOBJ;
				continue;
			case S_STR:
				hitNextAndReset(p, getstr(p.mBytes.subarray(0, p.mBytesLen)));
				continue;

			default:
				throwErr(p, "unknown state");
		}
	}
}

/**
 * @param {!PartialParser.Buff} b
 * @return {?Array}
 * @memberof PartialParser
 */
PartialParser.prototype.parseNext = function(b) {
	return parseNext(this, b);
};

}());

/**
 * @constructor
 * @memberof PartialParser
 */
PartialParser.Buff = function() {
	/** @type {?Uint8Array} */
	this.data = null;
	/** @type {number} */
	this.idx = 0;
	/** @type {number} */
	this.len = 0;
};

</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.10</a> using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>

<script src="scripts/search.js" defer></script>


<script src="scripts/collapse.js" defer></script>


</body>
</html>
