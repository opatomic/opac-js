#!/bin/bash



# increment the version build number; awk must write to temp file
awk -F '.' '{printf("%d.%d.%d",$1,$2,$3+1)}' version.txt > newver.txt
mv newver.txt version.txt
VERSION=`cat version.txt`


./build --publish

if [ $? -ne 0 ]; then { echo "command failed" ; exit 1; } fi

git add docs/*

if [ $? -ne 0 ]; then { echo "command failed" ; exit 1; } fi

git commit -m "build v$VERSION" version.txt browser/* node/* docs/*

if [ $? -ne 0 ]; then { echo "command failed" ; exit 1; } fi

npm publish node

echo published v$VERSION

